<script>
  const chatBox = document.getElementById("chatBox");
  const userInput = document.getElementById("userInput");

  let step = 0;
  let userData = {};
  let destinationUpdated = false;

  const steps = [
    "ğŸ‘‹ Hi there! I'm TravelBot â€“ your AI travel planner. Ready to plan your dream vacation?",
    "ğŸŒ Which continent are you thinking about? (Europe, Asia, America, Africa...)",
    "ğŸŒ Any specific country or city in mind?",
    "ğŸ“… When do you want to travel? (Exact dates or just a season like summer/winter)",
    "ğŸ•’ How many days do you plan to travel?",
    "ğŸ’¸ What's your budget per person?",
    "ğŸ§³ What kind of trip are you looking for? (Romantic, Family, Solo, Adventure, Relaxed, Party)",
    "ğŸ–ï¸ What kind of environment do you prefer? (Beach, Mountains, City, Island, Anything)",
    "ğŸ¨ Hotel or Airbnb or both?",
    "âœ… Anything special I should know? (Kids, Kosher, Birthday, Wheelchair etc.)",
    "ğŸ Perfect! Iâ€™ll prepare your recommendations now..."
  ];

  // ××™×œ×™× ×©×”×‘×•×˜ ××–×”×” ×›×“×™ ×œ×”×‘×™×Ÿ ×©×™× ×•×™/×›×•×•× ×”
  const keywordTriggers = {
    "kids": "ğŸ§’ How old are your kids?",
    "children": "ğŸ§¸ Any specific activities they enjoy?",
    "kosher": "ğŸ• Would you like to be near a synagogue or kosher food?",
    "halal": "ğŸ•Œ Do you want to be close to halal options?",
    "wheelchair": "â™¿ Should I filter for accessible locations?",
    "disabled": "â™¿ Iâ€™ll make sure everything is step-free!",
    "honeymoon": "ğŸ’– Got it! Looking for romantic & private locations!",
    "birthday": "ğŸ‰ Awesome! Should I include celebration-friendly spots?",
    "anniversary": "ğŸ’ Would you like couple packages or spa hotels?"
  };

  const cityContext = {
    "new york": "city",
    "paris": "city",
    "rome": "city",
    "thailand": "beach",
    "bali": "beach",
    "tel aviv": "beach",
    "switzerland": "mountain",
    "amsterdam": "city",
    "tokyo": "city",
    "london": "city"
  };

  // ×–×™×”×•×™ ×× ×”××©×ª××© ×©×™× ×” ×™×¢×“/×ª×©×•×‘×”
  const correctionPhrases = ["actually", "instead", "change", "no wait", "never mind", "forget", "i meant", "now", "not anymore"];

  // ×©×œ×™×—×ª ×”×•×“×¢×” ×œ×¦â€™××˜
  function addMessage(text, sender = "bot") {
    const msg = document.createElement("div");
    msg.className = "message " + sender;
    msg.innerText = text;
    chatBox.appendChild(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  // ×”×ª×—×œ×”
  window.onload = () => {
    setTimeout(() => addMessage(steps[0]), 500);
  };

  function handleUserInput() {
    const input = userInput.value.trim();
    if (!input) return;
    addMessage(input, "user");
    userInput.value = "";

    // ×‘×“×™×§×ª ××™×œ×•×ª ××¤×ª×— ××™×•×—×“×•×ª
    for (const key in keywordTriggers) {
      if (input.toLowerCase().includes(key)) {
        setTimeout(() => addMessage(keywordTriggers[key]), 700);
      }
    }

    // ×‘×“×™×§×ª ×ª×™×§×•×Ÿ ××• ×¢×“×›×•×Ÿ
    const lower = input.toLowerCase();
    const isCorrection = correctionPhrases.some(p => lower.includes(p));

    // ×©××™×¨×” ××• ×¢×“×›×•×Ÿ ×ª×©×•×‘×”
    const stepKey = getStepKey(step);
    if (isCorrection && stepKey) {
      userData[stepKey] = input;
      destinationUpdated = true;
      setTimeout(() => addMessage("âœ… Got it! I've updated your answer."), 600);
    } else if (stepKey) {
      if (!userData[stepKey]) {
        userData[stepKey] = input;
      } else {
        userData[stepKey] = input;
        destinationUpdated = true;
      }
    }

    // ×¢×“×›×•×Ÿ ×™×¢×“ ×œ×¤×™ ××™×œ×™× ×™×©×™×¨×•×ª
    Object.keys(cityContext).forEach(city => {
      if (lower.includes(city)) {
        userData["destination"] = city;
        destinationUpdated = true;
      }
    });

    // ×”×¦×’×ª ×©××œ×” ×”×‘××” ××• ×¡×™×•×
    step++;
    if (step < steps.length) {
      setTimeout(() => addMessage(steps[step]), 900);
    } else {
      setTimeout(() => showResults(), 1200);
    }
  }

  function getStepKey(step) {
    const map = {
      1: "continent",
      2: "destination",
      3: "dates",
      4: "duration",
      5: "budget",
      6: "tripType",
      7: "environment",
      8: "stay",
      9: "special",
    };
    return map[step] || null;
  }

  // ×™×¦×™×¨×ª ×”××œ×¦×•×ª
  function showResults() {
    const dest = userData["destination"] || "Europe";

    addMessage("ğŸ”¥ I've found exclusive deals just for you â€“ only available through TravelBot!");
    addMessage("ğŸ¯ Here are your custom travel suggestions:");

    const booking = `https://www.booking.com/searchresults.html?ss=${encodeURIComponent(dest)}`;
    const flights = `https://www.skyscanner.com/transport/flights-to/${dest.toLowerCase().replace(/ /g, "-")}/`;
    const airbnb = `https://www.airbnb.com/s/${encodeURIComponent(dest)}/homes`;

    setTimeout(() => {
      addMessage(`ğŸ¨ Hotels â†’ ${booking}`);
      addMessage(`âœˆï¸ Flights â†’ ${flights}`);
      addMessage(`ğŸ  Airbnb â†’ ${airbnb}`);
    }, 1000);
  }
</script>
</body>
</html>


<script>
  const chatBox = document.getElementById("chatBox");
  const userInput = document.getElementById("userInput");

  let step = 0;
  let userData = {};
  let destinationUpdated = false;

  const steps = [
    "👋 Hi there! I'm TravelBot – your AI travel planner. Ready to plan your dream vacation?",
    "🌍 Which continent are you thinking about? (Europe, Asia, America, Africa...)",
    "🌐 Any specific country or city in mind?",
    "📅 When do you want to travel? (Exact dates or just a season like summer/winter)",
    "🕒 How many days do you plan to travel?",
    "💸 What's your budget per person?",
    "🧳 What kind of trip are you looking for? (Romantic, Family, Solo, Adventure, Relaxed, Party)",
    "🏖️ What kind of environment do you prefer? (Beach, Mountains, City, Island, Anything)",
    "🏨 Hotel or Airbnb or both?",
    "✅ Anything special I should know? (Kids, Kosher, Birthday, Wheelchair etc.)",
    "🎁 Perfect! I’ll prepare your recommendations now..."
  ];

  // מילים שהבוט מזהה כדי להבין שינוי/כוונה
  const keywordTriggers = {
    "kids": "🧒 How old are your kids?",
    "children": "🧸 Any specific activities they enjoy?",
    "kosher": "🕍 Would you like to be near a synagogue or kosher food?",
    "halal": "🕌 Do you want to be close to halal options?",
    "wheelchair": "♿ Should I filter for accessible locations?",
    "disabled": "♿ I’ll make sure everything is step-free!",
    "honeymoon": "💖 Got it! Looking for romantic & private locations!",
    "birthday": "🎉 Awesome! Should I include celebration-friendly spots?",
    "anniversary": "💐 Would you like couple packages or spa hotels?"
  };

  const cityContext = {
    "new york": "city",
    "paris": "city",
    "rome": "city",
    "thailand": "beach",
    "bali": "beach",
    "tel aviv": "beach",
    "switzerland": "mountain",
    "amsterdam": "city",
    "tokyo": "city",
    "london": "city"
  };

  // זיהוי אם המשתמש שינה יעד/תשובה
  const correctionPhrases = ["actually", "instead", "change", "no wait", "never mind", "forget", "i meant", "now", "not anymore"];

  // שליחת הודעה לצ’אט
  function addMessage(text, sender = "bot") {
    const msg = document.createElement("div");
    msg.className = "message " + sender;
    msg.innerText = text;
    chatBox.appendChild(msg);
    chatBox.scrollTop = chatBox.scrollHeight;
  }

  // התחלה
  window.onload = () => {
    setTimeout(() => addMessage(steps[0]), 500);
  };

  function handleUserInput() {
    const input = userInput.value.trim();
    if (!input) return;
    addMessage(input, "user");
    userInput.value = "";

    // בדיקת מילות מפתח מיוחדות
    for (const key in keywordTriggers) {
      if (input.toLowerCase().includes(key)) {
        setTimeout(() => addMessage(keywordTriggers[key]), 700);
      }
    }

    // בדיקת תיקון או עדכון
    const lower = input.toLowerCase();
    const isCorrection = correctionPhrases.some(p => lower.includes(p));

    // שמירה או עדכון תשובה
    const stepKey = getStepKey(step);
    if (isCorrection && stepKey) {
      userData[stepKey] = input;
      destinationUpdated = true;
      setTimeout(() => addMessage("✅ Got it! I've updated your answer."), 600);
    } else if (stepKey) {
      if (!userData[stepKey]) {
        userData[stepKey] = input;
      } else {
        userData[stepKey] = input;
        destinationUpdated = true;
      }
    }

    // עדכון יעד לפי מילים ישירות
    Object.keys(cityContext).forEach(city => {
      if (lower.includes(city)) {
        userData["destination"] = city;
        destinationUpdated = true;
      }
    });

    // הצגת שאלה הבאה או סיום
    step++;
    if (step < steps.length) {
      setTimeout(() => addMessage(steps[step]), 900);
    } else {
      setTimeout(() => showResults(), 1200);
    }
  }

  function getStepKey(step) {
    const map = {
      1: "continent",
      2: "destination",
      3: "dates",
      4: "duration",
      5: "budget",
      6: "tripType",
      7: "environment",
      8: "stay",
      9: "special",
    };
    return map[step] || null;
  }

  // יצירת המלצות
  function showResults() {
    const dest = userData["destination"] || "Europe";

    addMessage("🔥 I've found exclusive deals just for you – only available through TravelBot!");
    addMessage("🎯 Here are your custom travel suggestions:");

    const booking = `https://www.booking.com/searchresults.html?ss=${encodeURIComponent(dest)}`;
    const flights = `https://www.skyscanner.com/transport/flights-to/${dest.toLowerCase().replace(/ /g, "-")}/`;
    const airbnb = `https://www.airbnb.com/s/${encodeURIComponent(dest)}/homes`;

    setTimeout(() => {
      addMessage(`🏨 Hotels → ${booking}`);
      addMessage(`✈️ Flights → ${flights}`);
      addMessage(`🏠 Airbnb → ${airbnb}`);
    }, 1000);
  }
</script>
</body>
</html>

